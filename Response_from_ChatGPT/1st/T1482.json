{
  "id":"chatcmpl-8O7tiEvyI4h5xcCFtmB6V1WSNU10P",
  "object":"chat.completion",
  "created":1700760922,
  "model":"gpt-3.5-turbo-0613",
  "choices":[
    {
      "index":0,
      "message":{
        "role":"assistant",
        "content":"[可實現]\n使用Python來撰寫執行T1482任務的程式碼。\n\n**第一種寫法：使用pywin32套件**\n```python\nimport win32net\nimport win32netcon\n\ndef enumerate_domain_trusts():\n    domain = 'target_domain'  # 目標網域名稱\n    level = 1  # 網域訊息的層級\n\n    try:\n        regions, total, resume_handle = win32net.NetEnumerateTrustedDomains(domain, level)\n        for region in regions:\n            print(f\"Trust Domain: {region['name']}\")\n    except Exception as e:\n        print(f\"Error: {e}\")\n\nenumerate_domain_trusts()\n```\n\n**第二種寫法：使用ldap3套件**\n```python\nfrom ldap3 import Server, Connection, SUBTREE, ALL\n\ndef enumerate_domain_trusts():\n    server_address = 'ldap://domain_controller_address'  # 目標網域控制器的位置\n    username = 'username'  # 帳號\n    password = 'password'  # 密碼\n    base_dn = 'DC=target_domain,DC=com'  # 網域的根節點\n\n    try:\n        server = Server(server_address, get_info=ALL)\n        conn = Connection(server, user=username, password=password)\n        conn.bind()\n\n        conn.search(base_dn, '(objectClass=trustedDomain)', SUBTREE)\n        for entry in conn.entries:\n            print(f\"Trust Domain: {entry.name.value}\")\n\n        conn.unbind()\n    except Exception as e:\n        print(f\"Error: {e}\")\n\nenumerate_domain_trusts()\n```\n\n**第三種寫法：使用impacket套件**\n```python\nfrom impacket.dcerpc.v5.dtypes import NULL\nfrom impacket.dcerpc.v5 import transport\n\ndef enumerate_domain_trusts():\n    target = 'target_domain_controller'  # 目標網域控制器\n    username = 'username'  # 帳號\n    password = 'password'  # 密碼\n\n    try:\n        rpctransport = transport.DCERPCTransportFactory(f'ncacn_ip_tcp:{target}')\n        rpctransport.set_credentials(username, password)\n        rpctransport.set_kerberos(True)\n\n        dce = rpctransport.get_dce_rpc()\n        dce.connect()\n        dce.bind('\\samr-interface', NULL)\n        \n        resp = dce.call('NetEnumerateTrustedDomains', NULL)\n        for trusted_domain in resp['Buffer']['TrustedDomainList']['Domains']:\n            print(f\"Trust Domain: {trusted_domain['Name'].decode('utf-16le')}\")\n\n        dce.disconnect()\n    except Exception as e:\n        print(f\"Error: {e}\")\n\nenumerate_domain_trusts()\n```\n\n**套件使用：**\n- 第一種寫法使用了pywin32套件，需使用`pip install pywin32`安裝。\n- 第二種寫法使用了ldap3套件，需使用`pip install ldap3`安裝。\n- 第三種寫法使用了impacket套件，需使用`pip install impacket`安裝。\n\n**輸出：**\n程式碼會列出目標網域的所有信任網域。"
      },
      "finish_reason":"stop"
    }
  ],
  "usage":{
    "prompt_tokens":682,
    "completion_tokens":783,
    "total_tokens":1465
  }
}